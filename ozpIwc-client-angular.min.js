angular.module("ozpIwcAngular",[]).factory("ozpIwc",function(){var a=a||{};a.AsyncAction=function(){this.callbacks={}},a.AsyncAction.prototype.when=function(a,b,c){return c=c||this,this.resolution===a?b.apply(c,this.value):this.callbacks[a]=function(){return b.apply(c,arguments)},this},a.AsyncAction.prototype.resolve=function(a){if(this.resolution)throw"Cannot resolve an already resolved AsyncAction";var b=this.callbacks[a];return this.resolution=a,this.value=Array.prototype.slice.call(arguments,1),b&&b.apply(this,this.value),this},a.AsyncAction.prototype.success=function(a,b){return this.when("success",a,b)},a.AsyncAction.prototype.failure=function(a,b){return this.when("failure",a,b)};var a=a||{};a.Event=function(){this.events={}},a.Event.prototype.on=function(a,b,c){var d=b;return c&&(d=function(){b.apply(c,arguments)},d.ozpIwcDelegateFor=b),this.events[a]=this.events[a]||[],this.events[a].push(d),d},a.Event.prototype.off=function(a,b){this.events[a]=(this.events[a]||[]).filter(function(a){return a!==b&&a.ozpIwcDelegateFor!==b})},a.Event.prototype.trigger=function(b,c){c=c||new a.CancelableEvent;var d=this.events[b]||[];return d.forEach(function(a){a(c)}),c},a.Event.prototype.mixinOnOff=function(a){var b=this;a.on=function(){return b.on.apply(b,arguments)},a.off=function(){return b.off.apply(b,arguments)}},a.CancelableEvent=function(a){a=a||{};for(var b in a)this[b]=a[b];this.canceled=!1,this.cancelReason=null},a.CancelableEvent.prototype.cancel=function(a){return a=a||"Unknown",this.canceled=!0,this.cancelReason=a,this};var a=a||{};a.log=a.log||{log:function(){window.console&&"function"==typeof window.console.log&&window.console.log.apply(window.console,arguments)},error:function(){window.console&&"function"==typeof window.console.error&&window.console.error.apply(window.console,arguments)}};var a=a||{};a.util=a.util||{},a.util.generateId=function(){return Math.floor(4294967295*Math.random()).toString(16)},a.util.now=function(){return(new Date).getTime()},a.util.extend=function(a,b){return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b},a.util.structuredCloneSupport=function(){if(void 0!==a.util.structuredCloneSupport.cache)return a.util.structuredCloneSupport.cache;var b=!1;try{window.postMessage({toString:function(){b=!0},blob:new Blob},"*")}catch(c){b=!0}return a.util.structuredCloneSupport.cache=!b,a.util.structuredCloneSupport.cache},a.util.structuredCloneSupport.cache=void 0,a.util.clone=function(a){return Array.isArray(a)||"object"==typeof a?JSON.parse(JSON.stringify(a)):a},a.util.arrayContainsAll=function(a,b,c){return c=c||function(a,b){return a===b},b.every(function(b){return a.some(function(a){return c(a,b)})})},a.util.objectContainsAll=function(a,b,c){c=c||function(a,b){return a===b};for(var d in b)if(!c(a[d],b[d]))return!1;return!0};var a=a||{};return a.Client=function(b){b=b||{},this.address="$nobody",this.replyCallbacks={},this.peerUrl=b.peerUrl;var c=document.createElement("a");c.href=this.peerUrl,this.peerOrigin=c.protocol+"//"+c.hostname,c.port&&(this.peerOrigin+=":"+c.port),this.autoPeer="autoPeer"in b?b.autoPeer:!0,this.msgIdSequence=0,this.events=new a.Event,this.events.mixinOnOff(this),this.receivedPackets=0,this.receivedBytes=0,this.sentPackets=0,this.sentBytes=0,this.startTime=a.util.now(),this.window=window;var d=this;this.autoPeer&&this.findPeer(),this.postMessageHandler=function(a){if(a.origin===d.peerOrigin)try{var b=a.data;"string"==typeof b&&(b=JSON.parse(a.data)),d.receive(b),d.receivedBytes+=2*a.data.length,d.receivedPackets++}catch(c){}},this.messageEventListener=window.addEventListener("message",this.postMessageHandler,!1)},a.Client.prototype.receive=function(a){a.replyTo&&this.replyCallbacks[a.replyTo]?this.replyCallbacks[a.replyTo](a)||this.cancelCallback(a.replyTo):this.events.trigger("receive",a)},a.Client.prototype.send=function(b,c){var d=(new Date).getTime(),e="p:"+this.msgIdSequence++,f={ver:1,src:this.address,msgId:e,time:d};for(var g in b)f[g]=b[g];c&&(this.replyCallbacks[e]=c);var h=f;return a.util.structuredCloneSupport()||(h=JSON.stringify(f)),this.peer.postMessage(h,"*"),this.sentBytes+=h.length,this.sentPackets++,f},a.Client.prototype.cancelCallback=function(a){var b=!1;return a&&(delete this.replyCallbacks[a],b=!0),b},a.Client.prototype.on=function(a,b){return"connected"===a&&"$nobody"!==this.address?void b(this):this.events.on.apply(this.events,arguments)},a.Client.prototype.off=function(){return this.events.off.apply(this.events,arguments)},a.Client.prototype.disconnect=function(){window.removeEventListener("message",this.messageEventListener,!1),this.iframe&&document.body.removeChild(this.iframe)},a.Client.prototype.createIframePeer=function(a){var b=this,c=function(){b.iframe=document.createElement("iframe"),b.iframe.src=a+"/iframe_peer.html",b.iframe.height=1,b.iframe.width=1,b.iframe.style="display:none !important;",b.iframe.addEventListener("load",function(){b.requestAddress()},!1),document.body.appendChild(b.iframe),b.peer=b.iframe.contentWindow};"complete"===document.readyState?c():window.addEventListener("load",c,!1)},a.Client.prototype.findPeer=function(){this.createIframePeer(this.peerUrl)},a.Client.prototype.requestAddress=function(){var a=this;this.send({dst:"$transport"},function(b){return a.address=b.dst,a.events.trigger("connected",a),null})},a});